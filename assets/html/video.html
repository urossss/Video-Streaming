<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Video-Streaming</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://bootswatch.com/4/darkly/bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function (event) {
            $.getJSON('/video-details', {
                url: document.URL
            },
                video => {
                    console.log(video);

                    let videoPlayer = document.getElementById('videoPlayer');

                    let videoSource = document.createElement('source');
                    videoSource.setAttribute('type', 'video/mp4');
                    videoSource.setAttribute('src', '/video/' + video.videoPath);
                    videoPlayer.appendChild(videoSource);

                    if (video.hasVtt) {
                        let subtitlesTrack = document.createElement('track');
                        subtitlesTrack.setAttribute('kind', 'subtitles');
                        subtitlesTrack.setAttribute('label', 'Default');
                        subtitlesTrack.setAttribute('src', '/subtitles/' + video.subtitlesPath);
                        videoPlayer.appendChild(subtitlesTrack);
                    }

                    let titleElement = document.getElementById('title');
                    titleElement.insertAdjacentHTML('beforeend', video.name + '&nbsp');

                    if (video.hasDetails) {
                        let yearElement = document.getElementById('year');
                        yearElement.insertAdjacentHTML('beforeend', '(' + video.details.year + ')');

                        let posterElement = document.getElementById('poster');
                        posterElement.setAttribute('src', video.details.poster);

                        let plotElement = document.getElementById('plot');
                        plotElement.insertAdjacentHTML('beforeend', '<br>' + video.details.plot + '<br>');

                        let writerElement = document.getElementById('writer');
                        writerElement.insertAdjacentHTML('beforeend', video.details.writer);

                        let directorElement = document.getElementById('director');
                        directorElement.insertAdjacentHTML('beforeend', video.details.director);

                        let genreElement = document.getElementById('genre');
                        genreElement.insertAdjacentHTML('beforeend', video.details.genres);

                        let castElement = document.getElementById('cast');
                        castElement.insertAdjacentHTML('beforeend', video.details.actors);

                        let durationElement = document.getElementById('duration');
                        let duration = parseInt(video.details.runtime);
                        let hours = Math.floor(duration / 60), minutes = duration % 60;
                        durationElement.insertAdjacentHTML('beforeend', hours + 'h ' + (minutes ? minutes + 'min' : ''));

                        let ratedElement = document.getElementById('rated');
                        ratedElement.insertAdjacentHTML('beforeend', video.details.rated);

                        let ratingElement = document.getElementById('rating');
                        ratingElement.insertAdjacentHTML('beforeend', video.details.rating);
                    }
                });
            console.log(document.URL);
        });
    </script>
</head>

<body>

    <div class="container" style="margin-top: 60px;">
        <div style="display:inline;">
            <h2 id="title" style="display:inline;"></h2>
            <h4 id="year" style="display:inline;"></h4>
        </div>
        <div class="container">
            <br>
            <span style="font-size: small">
                <span id="duration"></span>
                &nbsp&nbsp&nbsp&nbsp<span class="text-muted">|</span>&nbsp&nbsp&nbsp&nbsp
                <span id="rated"></span>
                &nbsp&nbsp&nbsp&nbsp<span class="text-muted">|</span>&nbsp&nbsp&nbsp&nbsp
                <span id="rating"></span>
            </span>
            <br><br><br>
            <div class="row">
                <img class="col-12 col-md-5 col-lg-3" id="poster">
                <table class="col-12 col-md-7 col-lg-9 center">
                    <tbody>
                        <tr>
                            <td colspan="2" id="plot"></td>
                        </tr>
                        <tr height="20px">
                        <tr>
                            <td class="text-muted" style="width: 30%;">DIRECTED BY</td>
                            <td id="director"></td>
                        </tr>
                        <tr height="10px">
                        </tr>
                        <tr>
                            <td class="text-muted">WRITTEN BY</td>
                            <td id="writer"></td>
                        </tr>
                        <tr height="10px">
                        </tr>
                        <tr>
                            <td class="text-muted">GENRE</td>
                            <td id="genre"></td>
                        </tr>
                        <tr height="10px">
                        </tr>
                        <tr>
                            <td class="text-muted">CAST</td>
                            <td id="cast"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <br><br>
            <video id="videoPlayer" width="100%" controls disablePictureInPicture controlsList="nodownload"></video>
        </div>
    </div>

</body>

</html>